include         /usr/local/etc/openldap/schema/core.schema
include         /usr/local/etc/openldap/schema/cosine.schema
include         /usr/local/etc/openldap/schema/inetorgperson.schema
include         /usr/local/etc/openldap/schema/nis.schema
include         /usr/local/etc/openldap/schema/esmile.schema
include         /usr/local/etc/openldap/schema/samba.schema

pidfile         /usr/local/var/run/slapd.pid
argsfile        /usr/local/var/run/slapd.args

modulepath      /usr/local/libexec/openldap
moduleload      back_mdb.la

# グローバルアクセス制御
access to dn.base="" by * read
access to dn.base="cn=Subschema" by * read
access to *
    by dn.exact="cn=admin,dc=e-smile,dc=ne,dc=jp" write
    by dn.exact="gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth" write
    by self write
    by group.exact="cn=ldapusers,ou=Groups,dc=e-smile,dc=ne,dc=jp" read
    by users read
    by anonymous auth

# メインDB設定
database        mdb
maxsize         1073741824
directory       /usr/local/var/openldap-data
suffix          "dc=e-smile,dc=ne,dc=jp"
rootdn          "cn=admin,dc=e-smile,dc=ne,dc=jp"
rootpw         {SSHA}NjGmWJPN6awr3upV1dUgUvLrDSI2U9l5


index           objectClass     eq

# モニターDB（内部監視用）
database        monitor

# 設定用DB（cn=config 管理）
database config
rootdn "cn=config"
access to *
    by dn.exact="gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth" manage
    by * none

